<!-- public/menu.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Menu</title>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
  <style>
    .menu-button {
      background-color: #fff;
      color: #333;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      font-weight: bold;
      
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s ease;
      position: relative;
      overflow: hidden;
      margin: 8px;
    }

    .menu-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background-color: #333;
      transition: left 0.3s ease;
      z-index: -1;
    }

    .menu-button:hover {
      background-color: #333;
      color: #fff;
      transform: translateY(-2px);
    }

    .menu-button:hover::before {
      left: 0;
    }

form {
  background-color: #333;
  border-radius: 10px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  padding: 20px;
  width: 80%;
  max-width: 600px;
  margin: 0 auto;
}

form label {
  display: block;
  font-weight: bold;
  margin: 10px 0;
}

form input[type="text"],
form input[type="number"],
form input[type="file"],
form select {
  width: 100%;
  padding: 10px;
  margin: 5px 0 15px;
  border: 1px solid #ccc;
  border-radius: 5px;
  font-size: 1rem;
}

form button {
  background-color: #444;
  color: #fff;
  padding: 10px 20px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 1rem;
}

form button:hover {
  background-color: #555;
}

form .success-message {
  color: green;
  margin-top: 10px;
}
form .error-message {
  color: red;
  margin-top: 10px;
}

    body {
      font-family: 'Poppins', sans-serif;
      line-height: 1.6;
      margin: 0;
      padding: 0;
      color: #fff;
      background-color: #444;
    }

    header {
      background-color: #333;
      color: #fff;
      padding: 1rem;
      text-align: center;
    }

    h1 {
      margin: 0;
      font-weight: 700;
    }

    /* Navigation Menu Styles */
    nav {
      background-color: #333;
      padding: 10px;
    }

    nav ul {
      list-style: none;
      display: flex;
      justify-content: center;
      margin: 0;
      padding: 0;
    }

    nav li {
      margin: 0 15px;
    }

    nav a {
      color: #fff;
      text-decoration: none;
      font-size: 1.2rem;
      font-weight: bold;
      transition: color 0.3s ease;
    }

    nav a:hover {
      color: #ffd700;
    }

    #menuList {
      list-style: none;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      padding: 20px;
      margin: 0;
    }

    .menu-item {
      background-color: #333;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      padding: 20px;
      text-align: center;
      transition: transform 0.3s ease;
    }

    .menu-item img {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 0 auto;
      border-radius: 10px;
      max-height: 200px;
      object-fit: cover;
    }

    .menu-item p {
      margin: 10px 0;
      font-size: 1.4rem;
      font-weight: bold;
    }

    @media screen and (max-width: 600px) {
      #menuList {
        grid-template-columns: 1fr;
      }
    }

    .menu-section {
      padding: 20px;
    }
    .menu-category {
      font-size: 1.5rem;
      font-weight: bold;
      margin: 10px 0;
    }

    .menu-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      padding: 20px;
      margin: 0;
    }
#li{
    background-color: #333;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      padding: 20px;
      height: 200px;
      width: 200px;
      text-align: center;
      transition: transform 0.3s ease;
      list-style-type: none;
      color: #fff;
}

#li:hover{
  background-color: #555;
  transition: .5s;
  
}
#img{
    height: 100px;
    width: auto;
    
}
#btn{
    border-radius: 50%;
    background-color: transparent;
}
#btn:hover{
    transition: .5s;
    background-color: #444;
    border-color: transparent;
}
.in-stock-button {
  background-color: #22bb33; /* Choose your desired color */
  color: #fff;
}

/* Style for "Out of Stock" state of the button */
.out-of-stock-button {
  
  color: #fff;
  padding: 8px 16px;
  border: none;
  border-radius: 4px;
  margin-top: 10px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}


/* Style for the delete button */
.delete-button {
  background-color: #ff5050; /* Choose your desired color */
  color: #fff;
  padding: 8px 16px;
  border: none;
  border-radius: 4px;
  margin-top: 10px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.delete-button:hover {
  background-color: #ff3333;
}

/* Ensure buttons appear on separate lines */
.menu-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
}


  #notificationContainer {
    position: fixed;
    bottom: 20px;
    left: 20px;
    background-color: #333;
    color: #fff;
    padding: 10px 20px;
    border-radius: 5px;
    display: none;
}

#notificationProgress {
    height: 5px;
    background-color: #ccc;
    margin-top: 5px;
    border-radius: 3px;
    width: 100%;
}
#notificationCloseButton {
    position: absolute;
    top: 5px;
    right: 5px;
    font-size: 20px;
    cursor: pointer;
}
#btn1{
    font-size: 64px;
}

#allbtn{
    background-color: transparent;
    border-color: transparent;
    border-radius: 50%;

}
#allbtn:hover{
    border-color: transparent;
    background-color: #444;
    transition: .5s;
    
}


#formh1{
  text-align: center;
}
body input{
  background-color: #333;
  color: #fff;
}
body input option{
  background-color: #333;
}



  </style>
</head>
<body>
  <header>
    <h1>Our Menu</h1>
  </header>

  <!-- Navigation Menu -->
  <nav>
    <ul class="category-list" id="categoryList"></ul>
  </nav>

  <!-- Add containers for each custom category -->
  <section class="menu-section" id="customCategoriesSection">
    <!-- Custom category items will be loaded dynamically here -->
  </section>
  <div id="notificationContainer">
    <span id="notificationMessage"></span>
    <div id="notificationProgress"></div>
</div>

  <ul id="menuList" class="menu-container">
    <!-- Menu items will be loaded dynamically here -->
  </ul>


<div id="addlist">
  <h1 id="formh1">Add Item to Menu</h1>
  <form id="menuForm" enctype="multipart/form-data">
      <label for="itemName">Item Name:</label>
      <input type="text" id="itemName" name="itemName" required>
      <label for="itemPrice">Item Price:</label>
      <input type="number" id="itemPrice" name="itemPrice" required>
      <label for="itemCategory">Item Category:</label>
      <select id="itemCategory" name="itemCategory" required>
        <!-- Categories will be loaded dynamically here -->
      </select>
      <label for="itemImage">Item Image:</label>
      <input type="file" id="itemImage" name="itemImage">
      <label for="itemPlacement">Item Placement:</label>
      <input type="text" id="itemPlacement" name="itemPlacement">
      <label for="itemTime">Estimated time:</label>
      <input type="text" id="itemTime" name="itemTime">
      <button type="submit" name="addItem">Add to Menu</button>
    </form>
</div>

<div id="addclist">
  <h1 id="formh1">Create Custom Category</h1>
  <form id="categoryForm">
      <label for="customCategory">Category Name:</label>
      <input type="text" id="customCategory" required>
      <button type="submit">Add Category</button>
  </form>
</div>

<div id="removeclist">

  <h1 id="formh1">Remove Category</h1>
  <form id="removeCategoryForm">
    <label for="removeCategory">Select Category to Remove:</label>
    <select id="removeCategory" name="removeCategory" required>
      <!-- Categories will be loaded dynamically here -->
    </select>
    <button type="submit">Remove Category</button>
  </form>
</div>

  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

<script>
  function checkEnteredUser(){
    const urlParams = new URLSearchParams(window.location.search);
      const code = urlParams.get('code');
      const username = urlParams.get('username');
      const role = urlParams.get('role');
    if(!code || !username || !role){
      return window.location.href = "/menu/menu.html"
    }
    if(role =="menu editor" || role =="admin"){

    }else{
      return window.location.href = "/menu/menu.html"
    }
  }
  checkEnteredUser()
</script>
  <script>

    // public/js/script.js
document.addEventListener('DOMContentLoaded', () => {

    const notificationContainer = document.getElementById('notificationContainer');
const notificationMessage = document.getElementById('notificationMessage');
const notificationProgress = document.getElementById('notificationProgress');

let notificationTimeout; // To store the timeout for hiding the notification

// Function to show the notification
function showNotification(message, duration) {
    notificationMessage.textContent = message;
    notificationContainer.style.display = 'block';
    
    // Reset progress bar
    notificationProgress.style.width = '100%';

    // Calculate the interval duration for reducing the progress bar width
    const intervalDuration = Math.floor(duration / 100);
    let progress = 100;

    // Decrease the progress bar width over time
    const progressBarInterval = setInterval(() => {
        progress -= 1;
        notificationProgress.style.width = `${progress}%`;
    }, intervalDuration);

    // Clear the interval and hide the notification after the given duration
    notificationTimeout = setTimeout(() => {
        clearInterval(progressBarInterval);
        notificationContainer.style.display = 'none';
    }, duration);

    const closeButton = document.createElement('span');
    closeButton.id = 'notificationCloseButton';
    closeButton.innerHTML = '&times;';
    closeButton.addEventListener('click', () => {
        clearTimeout(notificationTimeout);
        notificationContainer.style.display = 'none';
    });

    // Append the close button to the notification container
    notificationContainer.appendChild(closeButton);
}

  


// Function to create a delete button for a menu item
function createDeleteButton(itemID) {

  const deleteButton = document.createElement('button');
 
  deleteButton.textContent = 'Delete';
  deleteButton.classList.add('delete-button');
  deleteButton.addEventListener('click', (event) => {
    event.preventDefault()
    deleteMenuItem(itemID)
    showNotification("Successfully deleted", 5000)
});
  return deleteButton;
}

// Function to delete a menu item from the database
function deleteMenuItem(itemID) {
  fetch(`/delete-item/${itemID}`, { method: 'DELETE' })
    .then((response) => response.json())
    .then((data) => {
      if (data.success) {
        // If the item was deleted successfully, reload the menu
        loadMenuItems();
      } else {
        console.error('Error deleting menu item:', data.error);
      }
    })
    .catch((error) => {
      console.error('Error deleting menu item:', error);
    });
}

function loadCustomCategories() {
fetch('/api/categories')
  .then((response) => response.json())
  .then((categories) => {
    categoryList.innerHTML = '';
    categories.forEach((category) => {
      const li = document.createElement('button');
      li.textContent = category.name;
     
      categoryList.appendChild(li);
      li.addEventListener('click', () => showCategory(category.name));
    });
    if (categories.length > 0) {
      showCategory(categories[0].name); // Show the first custom category by default
    }
  })
  .catch((error) => {
    console.error('Error loading custom categories:', error);
  });
}

const menuList = document.getElementById('menuList');
const categoryList = document.querySelector('.category-list');
const customCategoriesSection = document.getElementById('customCategoriesSection');
function showCategory(category) {
const menuItems = document.querySelectorAll('.menu-item');
menuItems.forEach((item) => {
  if (category === 'all' || item.classList.contains(category.replace(/\s+/g, '_'))) {
    item.style.display = 'block';
  } else {
    item.style.display = 'none';
  }
});
}



function loadCategories() {
fetch('/api/categories')
  .then((response) => response.json())
  .then((categories) => {
    categoryList.innerHTML = '';
    categories.forEach((category) => {
      const button = document.createElement('button');
      const categoryClass = category.name.replace(/\s+/g, '_'); // Replace spaces with underscores
      button.textContent = category.name;
      button.className = "menu-button"
      button.classList.add(categoryClass); // Add the modified category name as a class
      categoryList.appendChild(button);
      button.addEventListener('click', () => loadCategoryItems(category.name));
    });
  })
  .catch((error) => {
    console.error('Error loading categories:', error);
  });
}




function createMenuItem(item, currency) {
  const listItem = document.createElement('li');
  listItem.classList.add('menu-item');
  listItem.classList.add(item.category);

  listItem.innerHTML = `
    <img src="${item.image}" alt="${item.name}">
    <p>${item.name}</p>
    <p>Price: ${item.price}${currency}</p>
  `;

  // Create the delete button for this item
  const deleteButton = createDeleteButton(item.id);
  listItem.appendChild(deleteButton);

  // Create the "Out of Stock" button for this item
  const outOfStockButton = document.createElement('button');
  outOfStockButton.textContent = item.out_of_stock === 1 ? 'Put Back in Stock' : 'Out of Stock';
  outOfStockButton.classList.add('out-of-stock-button');
  outOfStockButton.addEventListener('click', () => toggleItemStockStatus(item, listItem, outOfStockButton));
  listItem.appendChild(outOfStockButton);

  // Apply styles for "Out of Stock" items
  if (item.out_of_stock === 1) {
    listItem.classList.add('out-of-stock');
  }

  return listItem;
}

function loadMenuItems(category = 'all') {
        fetch(`/api/menu?category=${encodeURIComponent(category)}`)
          .then((response) => response.json())
          .then((data) => {
            menuList.innerHTML = '';
    
            data.forEach((item) => {
              const listItem = document.createElement('li');
              listItem.classList.add('menu-item');
              listItem.classList.add(item.category);
    
              listItem.innerHTML = `
                <img src="${item.image}" alt="${item.name}">
                <p>${item.name}</p>
                <p>Price: ${item.price}$</p>
              `;
    
              // Create the "Out of Stock" button
              const outOfStockButton = document.createElement('button');
              outOfStockButton.textContent = item.out_of_stock === 1 ?  'Out of Stock': 'Put Back in Stock' ;
              outOfStockButton.classList.add('out-of-stock-button');
    
              outOfStockButton.addEventListener('click', () => {
                toggleItemStockStatus(item.id, listItem, outOfStockButton);
              });
            
    
              listItem.appendChild(outOfStockButton);
              if (item.out_of_stock === 1) {
                outOfStockButton.style.backgroundColor = "rgb(255, 51, 51)"
    
      }else{
        outOfStockButton.style.backgroundColor = "rgb(34, 187, 51)"
       
      }
              // Create the delete button
              const deleteButton = document.createElement('button');
              deleteButton.textContent = 'Delete';
              deleteButton.classList.add('delete-button');
    
              deleteButton.addEventListener('click', () => {
                deleteMenuItem(item.id, listItem);
              });
    
              listItem.appendChild(deleteButton);
    
              menuList.appendChild(listItem);
            });
          })
          .catch((error) => {
            console.error('Error loading menu:', error);
          });
      }
    
      // Function to toggle the stock status of an item
      function toggleItemStockStatus(itemId, listItem, outOfStockButton) {
        const newStatus = outOfStockButton.textContent === 'Put Back in Stock' ? 1 : 2;
    
        fetch(`/api/toggle-stock/${itemId}/${newStatus}`, { method: 'POST' })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              // Update the item's appearance and the button text
              window.location.reload()
              showNotification('Stock status updated', 5000);
              listItem.classList.toggle('out-of-stock');
              outOfStockButton.textContent = newStatus === 1 ? 'Put Back in Stock' : 'Out of Stock';
            } else {
              console.error('Error updating stock status:', data.error);
            }
          })
          .catch((error) => {
            console.error('Error updating stock status:', error);
          });
      }
function markItemOutOfStock(itemId) {
  fetch(`/api/mark-out-of-stock/${itemId}`, { method: 'POST' })
    .then((response) => response.json())
    .then((data) => {
      if (data.success) {
        // Display a success message and update the item's appearance
        showNotification('Item marked as Out of Stock', 5000);
        const listItem = menuList.querySelector(`[data-item-id="${itemId}"]`);
        listItem.classList.add('out-of-stock'); // Add a CSS class to style the item as "Out of Stock"
      } else {
        console.error('Error marking item as Out of Stock:', data.error);
      }
    })
    .catch((error) => {
      console.error('Error marking item as Out of Stock:', error);
    });
}






menuList.addEventListener("click", function(event) {
    const target = event.target;
    if (target.matches("#btn")) {
      alert
    }
  });


  async function getCurrency() {
  try {
    const response = await fetch('/api/env');
    const data = await response.json();
    return data.currency;
  } catch (error) {
    console.error('Error fetching environment variables:', error);
    return null;
  }
}
 


async function loadCategoryItems(category) {
  const currency = await getCurrency()
  
loadMenuItems(category, currency);
}


loadCustomCategories();
loadCategories();
loadCategoryItems('all'); // Load all items initially
});



  </script>

<script>
function showNotification(message, duration) {
    notificationMessage.textContent = message;
    notificationContainer.style.display = 'block';
    
    // Reset progress bar
    notificationProgress.style.width = '100%';

    // Calculate the interval duration for reducing the progress bar width
    const intervalDuration = Math.floor(duration / 100);
    let progress = 100;

    // Decrease the progress bar width over time
    const progressBarInterval = setInterval(() => {
        progress -= 1;
        notificationProgress.style.width = `${progress}%`;
    }, intervalDuration);

    // Clear the interval and hide the notification after the given duration
    notificationTimeout = setTimeout(() => {
        clearInterval(progressBarInterval);
        notificationContainer.style.display = 'none';
    }, duration);

    const closeButton = document.createElement('span');
    closeButton.id = 'notificationCloseButton';
    closeButton.innerHTML = '&times;';
    closeButton.addEventListener('click', () => {
        clearTimeout(notificationTimeout);
        notificationContainer.style.display = 'none';
    });

    // Append the close button to the notification container
    notificationContainer.appendChild(closeButton);
}
  function loadCategoryItems(category, currency) {
    // Fetch items based on the selected category from the server
    fetch(`/api/menu?category=${encodeURIComponent(category)}`)
      .then((response) => response.json())
      .then((items) => {
        const categoryItemsContainer = document.getElementById('categoryItems');
        categoryItemsContainer.innerHTML = ''; // Clear previous content
  
        items.forEach((item) => {
          // Create a div element for each item
          const itemDiv = document.createElement('div');
          itemDiv.classList.add('menu-item');
  
          // Create an image element for the item image
          if (item.image) {
            const itemImage = document.createElement('img');
            itemImage.src = item.image;
            itemDiv.appendChild(itemImage);
          }
  
          // Create a heading element for the item name
          const itemNameHeading = document.createElement('h2');
          itemNameHeading.textContent = item.name;
          itemDiv.appendChild(itemNameHeading);
  
          // Create a paragraph element for the item price
          const itemPriceParagraph = document.createElement('p');
          itemPriceParagraph.textContent = `$${item.price.toFixed(2)}`;
          itemDiv.appendChild(itemPriceParagraph);
  
          // Add the item div to the category items container
          categoryItemsContainer.appendChild(itemDiv);
        });
      })
      .catch((error) => {
        console.error('Error loading category items:', error);
      });
  }
               function toggleDynamicMenu() {
              const dynamicMenuContent = document.getElementById('dynamicMenuContent');
              const up = document.getElementById("up")
              const down = document.getElementById("down")
              dynamicMenuContent.classList.toggle('show');
              up.classList.toggle("show")
              down.classList.toggle("notshow")
          }
              document.addEventListener('DOMContentLoaded', () => {
                
                  const menuForm = document.getElementById('menuForm');
                  const itemImage = document.getElementById('itemImage');
                  const categoryForm = document.getElementById('categoryForm');
                  const categoryList = document.getElementById('categoryList');
                  const itemCategorySelect = document.getElementById('itemCategory');
                  function loadCategoriesIntoDropdown() {
        fetch('/api/categories')
          .then((response) => response.json())
          .then((categories) => {
            itemCategorySelect.innerHTML = '';
            categories.forEach((category) => {
              const option = document.createElement('option');
              option.value = category.name;
              option.textContent = category.name;
              itemCategorySelect.appendChild(option);
            });
          })
          .catch((error) => {
            console.error('Error loading categories:', error);
          });
      }
  
      // Load categories into the itemCategorySelect dropdown when the page is loaded
      loadCategoriesIntoDropdown();
                  // Function to load categories from the server
              
      
                  
      
                  categoryForm.addEventListener('submit', (event) => {
                      event.preventDefault();
      
                      const customCategory = document.getElementById('customCategory').value;
                      showNotification("Successfully added category", 5000)
                      if (customCategory) {
                          fetch('/add-category', {
                              method: 'POST',
                              headers: {
                                  'Content-Type': 'application/x-www-form-urlencoded',
                              },
                              body: `category=${customCategory}`,
                          })
                          .then(() => {
                              categoryForm.reset();
                              loadCategories();
                          })
                          .catch((error) => {
                              console.error('Error adding custom category:', error);
                          });
                      }
                  });
      
                  // Load categories when the page is loaded
                 
  
                  menuForm.addEventListener('submit', (event) => {
      event.preventDefault();
  
      // Gather form data using FormData
      const formData = new FormData(menuForm);
      const itemName = formData.get('itemName');
      const itemPrice = formData.get('itemPrice');
      const itemCategory = formData.get('itemCategory');
      const itemImageFile = formData.get('itemImage');
      const itemPlacement = formData.get("itemPlacement")
      const itemTime = formData.get("itemTime")
  
      // Validate form data
      if (!itemName || isNaN(parseFloat(itemPrice)) || !itemCategory) {
        console.error('Invalid item name, price, or category.');
        return;
      }
  
      // Prepare form data to send as multipart/form-data
      const formDataToSend = new FormData();
      formDataToSend.append('itemName', itemName);
      formDataToSend.append('itemPrice', parseFloat(itemPrice));
      formDataToSend.append('itemCategory', itemCategory);
      if (itemImageFile) {
        formDataToSend.append('itemImage', itemImageFile);
      }
      formDataToSend.append("itemPlacement", itemPlacement)
      formDataToSend.append("itemTime", itemTime)
      alert(itemTime)
      showNotification(`Successfully added ${itemName} to ${itemCategory}`, 5000)
      // Fetch request to the server to add the item
      fetch('/add-to-menu', {
        method: 'POST',
        body: formDataToSend,
      })
        .then((response) => response.json())
        .then((data) => {
          console.log('Server response:', data);
          loadCategoryItems(itemCategory);
          
        
          menuForm.reset();
        })
        .catch((error) => {
          console.error('Error adding item to menu:', error);
        });
    });
  
      // Load categories for the remove category selection box
      function loadRemoveCategories() {
        fetch('/api/categories')
          .then((response) => response.json())
          .then((categories) => {
            const removeCategorySelect = document.getElementById('removeCategory');
            removeCategorySelect.innerHTML = '';
            categories.forEach((category) => {
              const option = document.createElement('option');
              option.value = category.name;
              option.textContent = category.name;
              removeCategorySelect.appendChild(option);
            });
          })
          .catch((error) => {
            console.error('Error loading categories:', error);
          });
      }
  
      // ... (existing code)
  
      // Load remove categories when the page is loaded
      loadRemoveCategories();
  
      // Form submission to remove a category
      const removeCategoryForm = document.getElementById('removeCategoryForm');
      removeCategoryForm.addEventListener('submit', (event) => {
        event.preventDefault();
  
        const removeCategory = document.getElementById('removeCategory').value;
  
        if (removeCategory) {
          showNotification(`Successfully deleted category ${removeCategory}`, 5000)
          fetch('/remove-category', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `category=${removeCategory}`,
          })
            .then(() => {
             
              loadRemoveCategories();
              loadCategories(); // Refresh the categories list for the other forms
            })
            .catch((error) => {
              console.error('Error removing category:', error);
            });
        }
      });
              });
  
  
              //collapsable
            
    
          </script>
  
</body>
</html>
